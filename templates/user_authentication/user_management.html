{% extends 'base.html' %} {% block title %}User Management - Helping Hands
{%endblock %} {% block content %}

<style>
  .user-management-container {
    padding: 2rem 0;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    min-height: calc(100vh - 150px);
  }
  
  .page-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    padding: 2rem;
    margin-bottom: 2rem;
    color: white;
    box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
  }
  
  .page-header h2 {
    font-family: "Poppins", sans-serif;
    font-weight: 800;
    margin: 0;
    font-size: 2rem;
  }
  
  .btn-primary {
    background: white;
    color: #667eea;
    border: none;
    border-radius: 50px;
    padding: 0.75rem 2rem;
    font-weight: 700;
    font-family: "Poppins", sans-serif;
    transition: all 0.3s ease;
  }
  
  .btn-primary:hover {
    background: #f0f0f0;
    color: #764ba2;
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
  }
  
  .stat-card {
    background: white;
    border-radius: 16px;
    padding: 1.8rem;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    text-align: center;
    position: relative;
    overflow: hidden;
  }
  
  .stat-card::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
  }
  
  .stat-card.primary::before {
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
  }
  
  .stat-card.success::before {
    background: linear-gradient(90deg, #10b981 0%, #059669 100%);
  }
  
  .stat-card.info::before {
    background: linear-gradient(90deg, #06b6d4 0%, #0891b2 100%);
  }
  
  .stat-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 16px 40px rgba(102, 126, 234, 0.2);
  }
  
  .stat-card h5 {
    font-family: "Poppins", sans-serif;
    font-weight: 600;
    color: #666;
    font-size: 0.95rem;
    margin-bottom: 1rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .stat-card h2 {
    font-family: "Poppins", sans-serif;
    font-weight: 800;
    font-size: 2.5rem;
    margin: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  .nav-tabs {
    background: white;
    border-radius: 16px;
    padding: 0.5rem;
    border: none;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
  }
  
  .nav-tabs .nav-link {
    border: none;
    border-radius: 12px;
    font-weight: 600;
    font-family: "Poppins", sans-serif;
    color: #666;
    transition: all 0.3s ease;
    padding: 0.75rem 1.5rem;
  }
  
  .nav-tabs .nav-link.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
  }
  
  .nav-tabs .nav-link:hover {
    color: #667eea;
  }
  
  .table-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    padding: 1.5rem;
    border: none;
  }
  
  .table {
    margin: 0;
  }
  
  .table thead th {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    border: none;
    padding: 1rem;
    font-family: "Poppins", sans-serif;
    font-weight: 700;
    color: #333;
    text-transform: uppercase;
    font-size: 0.85rem;
    letter-spacing: 0.5px;
  }
  
  .table tbody tr {
    transition: all 0.3s ease;
  }
  
  .table tbody tr:hover {
    background: rgba(102, 126, 234, 0.05);
  }
  
  .table tbody td {
    padding: 1rem;
    vertical-align: middle;
    border-color: #f0f0f0;
  }
  
  .badge {
    padding: 0.5rem 1rem;
    border-radius: 50px;
    font-weight: 600;
    font-size: 0.8rem;
  }
  
  .badge.bg-danger {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%) !important;
  }
  
  .badge.bg-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
  }
  
  .badge.bg-success {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
  }
  
  .btn-warning, .btn-danger {
    border-radius: 50px;
    padding: 0.4rem 1rem;
    font-weight: 600;
    font-size: 0.85rem;
    border: none;
    transition: all 0.3s ease;
  }
  
  .btn-warning {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  }
  
  .btn-danger {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  }
  
  .btn-warning:hover, .btn-danger:hover {
    transform: translateY(-2px);
  }
</style>

<div class="user-management-container">
<div class="container">
  <div class="page-header">
    <h2><i class="bi bi-people-fill"></i> User Management</h2>
    <a href="{% url 'create_user' %}" class="btn btn-primary">
      <i class="bi bi-person-plus-fill"></i> Create New User
    </a>
  </div>

  {% if messages %} {% for message in messages %}
  <div
    class="alert alert-{{ message.tags }} alert-dismissible fade show"
    role="alert"
  >
    {{ message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
  {% endfor %} {% endif %}

  <!-- Stats Cards -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="stat-card primary">
        <h5><i class="bi bi-shield-check"></i> Managers</h5>
        <h2>{{ managers_count }}</h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="stat-card success">
        <h5><i class="bi bi-people"></i> Staff</h5>
        <h2>{{ staff_count }}</h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="stat-card info">
        <h5><i class="bi bi-person-check"></i> Total Users</h5>
        <h2>{{ total_users }}</h2>
      </div>
    </div>
  </div>

  <!-- Filter Tabs -->
  <ul class="nav nav-tabs mb-3" role="tablist">
    <li class="nav-item" role="presentation">
      <button
        class="nav-link active"
        data-bs-toggle="tab"
        data-bs-target="#all-users"
        type="button"
      >
        All Users
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button
        class="nav-link"
        data-bs-toggle="tab"
        data-bs-target="#managers"
        type="button"
      >
        Managers
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button
        class="nav-link"
        data-bs-toggle="tab"
        data-bs-target="#staff"
        type="button"
      >
        Staff
      </button>
    </li>
  </ul>

  <div class="tab-content">
    <!-- All Users Tab -->
    <div class="tab-pane fade show active" id="all-users">
      <div class="table-card">
        <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Username</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Role</th>
                  <th>Phone</th>
                  <th>Created</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for user in users %}
                <tr>
                  <td><strong>{{ user.username }}</strong></td>
                  <td>{{ user.get_full_name|default:"-" }}</td>
                  <td>{{ user.email }}</td>
                  <td>
                    {% if user.role == 'admin' %}
                    <span class="badge bg-danger">Admin</span>
                    {% elif user.role == 'manager' %}
                    <span class="badge bg-primary">Manager</span>
                    {% else %}
                    <span class="badge bg-success">Staff</span>
                    {% endif %}
                  </td>
                  <td>{{ user.phone|default:"-" }}</td>
                  <td>{{ user.created_at|date:"M d, Y" }}</td>
                  <td>
                    {% if user.role != 'admin' %}
                    <a
                      href="{% url 'edit_user' user.id %}"
                      class="btn btn-sm btn-warning"
                    >
                      <i class="bi bi-pencil"></i> Edit
                    </a>
                    <button
                      class="btn btn-sm btn-danger"
                      onclick="confirmDelete('{{ user.username }}', {{ user.id }})"
                    >
                      <i class="bi bi-trash"></i> Delete
                    </button>
                    {% else %}
                    <span class="text-muted">Protected</span>
                    {% endif %}
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="7" class="text-center text-muted">
                    No users found
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Managers Tab -->
    <div class="tab-pane fade" id="managers">
      <div class="table-card">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Username</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Shifts Created</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for manager in managers %}
                <tr>
                  <td><strong>{{ manager.username }}</strong></td>
                  <td>{{ manager.get_full_name|default:"-" }}</td>
                  <td>{{ manager.email }}</td>
                  <td>{{ manager.phone|default:"-" }}</td>
                  <td>{{ manager.posted_shifts.count }}</td>
                  <td>
                    <a
                      href="{% url 'edit_user' manager.id %}"
                      class="btn btn-sm btn-warning"
                    >
                      <i class="bi bi-pencil"></i> Edit
                    </a>
                    <button
                      class="btn btn-sm btn-danger"
                      onclick="confirmDelete('{{ manager.username }}', {{ manager.id }})"
                    >
                      <i class="bi bi-trash"></i> Delete
                    </button>
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="6" class="text-center text-muted">
                    No managers found
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Staff Tab -->
    <div class="tab-pane fade" id="staff">
      <div class="table-card">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Username</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Applications</th>
                  <th>Approved</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for staff_member in staff %}
                <tr>
                  <td><strong>{{ staff_member.username }}</strong></td>
                  <td>{{ staff_member.get_full_name|default:"-" }}</td>
                  <td>{{ staff_member.email }}</td>
                  <td>{{ staff_member.phone|default:"-" }}</td>
                  <td>{{ staff_member.shift_applications.count }}</td>
                  <td>{{ staff_member.shift_applications.filter.count }}</td>
                  <td>
                    <a
                      href="{% url 'edit_user' staff_member.id %}"
                      class="btn btn-sm btn-warning"
                    >
                      <i class="bi bi-pencil"></i> Edit
                    </a>
                    <button
                      class="btn btn-sm btn-danger"
                      onclick="confirmDelete('{{ staff_member.username }}', {{ staff_member.id }})"
                    >
                      <i class="bi bi-trash"></i> Delete
                    </button>
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="7" class="text-center text-muted">
                    No staff members found
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title">
          <i class="bi bi-exclamation-triangle"></i> Confirm Delete
        </h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <div class="modal-body">
        <p>
          Are you sure you want to delete user
          <strong id="deleteUsername"></strong>?
        </p>
        <p class="text-danger">
          <i class="bi bi-warning"></i> This action cannot be undone!
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancel
        </button>
        <form id="deleteForm" method="post" style="display: inline">
          {% csrf_token %}
          <button type="submit" class="btn btn-danger">Delete User</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  function confirmDelete(username, userId) {
    document.getElementById("deleteUsername").textContent = username;
    document.getElementById(
      "deleteForm"
    ).action = `/auth/delete-user/${userId}/`;
    new bootstrap.Modal(document.getElementById("deleteModal")).show();
  }
</script>

{% endblock %}
